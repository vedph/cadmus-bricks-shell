<form [formGroup]="form">
  <div>
    <!-- tag (bound) -->
    <mat-form-field style="width: 6em" *ngIf="tagEntries?.length">
      <mat-label>tag</mat-label>
      <mat-select [formControl]="tag">
        <mat-option *ngFor="let e of tagEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- tag (free) -->
    <mat-form-field style="width: 5em" *ngIf="!tagEntries?.length">
      <mat-label>tag</mat-label>
      <input matInput [formControl]="tag" />
      <mat-error
        *ngIf="$any(tag).errors?.maxLength && (tag.dirty || tag.touched)"
        >tag too long</mat-error
      >
    </mat-form-field>

    <!-- label -->
    <span class="label" *ngIf="label">{{ label }}</span>
  </div>

  <!-- w -->
  <ng-template #w>
    <!-- value -->
    <mat-form-field style="width: 5em">
      <mat-label>width</mat-label>
      <input matInput type="number" min="0" [formControl]="wValue" />
    </mat-form-field>
    &nbsp;
    <!-- unit -->
    <mat-form-field style="width: 6em">
      <mat-label>unit</mat-label>
      <mat-select [formControl]="wUnit">
        <mat-option *ngFor="let e of unitEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
      <mat-error
        *ngIf="$any(wUnit).errors?.required && (wUnit.dirty || wUnit.touched)"
        >unit required</mat-error
      >
    </mat-form-field>
    &nbsp;
    <!-- tag (bound) -->
    <mat-form-field style="width: 6em" *ngIf="dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <mat-select [formControl]="wTag">
        <mat-option *ngFor="let e of dimTagEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- tag (free) -->
    <mat-form-field style="width: 5em" *ngIf="!dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <input matInput [formControl]="wTag" />
      <mat-error
        *ngIf="$any(wTag).errors?.maxLength && (wTag.dirty || wTag.touched)"
        >tag too long</mat-error
      >
    </mat-form-field>
  </ng-template>

  <!-- h -->
  <ng-template #h>
    <!-- value -->
    <mat-form-field style="width: 5em">
      <mat-label>height</mat-label>
      <input matInput type="number" min="0" [formControl]="hValue" />
    </mat-form-field>
    &nbsp;
    <!-- unit -->
    <mat-form-field style="width: 6em">
      <mat-select [formControl]="hUnit">
        <mat-label>unit</mat-label>
        <mat-option *ngFor="let e of unitEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
      <mat-error
        *ngIf="$any(hUnit).errors?.required && (hUnit.dirty || hUnit.touched)"
        >unit required</mat-error
      >
    </mat-form-field>
    &nbsp;
    <!-- tag (bound) -->
    <mat-form-field style="width: 6em" *ngIf="dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <mat-select [formControl]="hTag">
        <mat-option *ngFor="let e of dimTagEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- tag (free) -->
    <mat-form-field style="width: 5em" *ngIf="!dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <input matInput [formControl]="hTag" />
      <mat-error
        *ngIf="$any(hTag).errors?.maxLength && (hTag.dirty || hTag.touched)"
        >tag too long</mat-error
      >
    </mat-form-field>
  </ng-template>

  <ng-container *ngIf="hBeforeW">
    <div>
      <ng-container *ngTemplateOutlet="h"></ng-container>
    </div>
    <div>
      <ng-container *ngTemplateOutlet="w"></ng-container>
    </div>
  </ng-container>
  <ng-container *ngIf="!hBeforeW">
    <div>
      <ng-container *ngTemplateOutlet="w"></ng-container>
    </div>
    <div>
      <ng-container *ngTemplateOutlet="h"></ng-container>
    </div>
  </ng-container>

  <!-- d -->
  <div>
    <!-- value -->
    <mat-form-field style="width: 5em">
      <mat-label>depth</mat-label>
      <input matInput type="number" min="0" [formControl]="dValue" />
    </mat-form-field>
    &nbsp;
    <!-- unit -->
    <mat-form-field style="width: 6em">
      <mat-label>unit</mat-label>
      <mat-select [formControl]="dUnit">
        <mat-option *ngFor="let e of unitEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
      <mat-error
        *ngIf="$any(dUnit).errors?.required && (dUnit.dirty || dUnit.touched)"
        >unit required</mat-error
      >
    </mat-form-field>
    &nbsp;
    <!-- tag (bound) -->
    <mat-form-field style="width: 6em" *ngIf="dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <mat-select [formControl]="dTag">
        <mat-option *ngFor="let e of dimTagEntries" [value]="e.id">{{
          e.value
        }}</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- tag (free) -->
    <mat-form-field style="width: 5em" *ngIf="!dimTagEntries?.length">
      <mat-label>tag</mat-label>
      <input matInput [formControl]="dTag" />
      <mat-error
        *ngIf="$any(dTag).errors?.maxLength && (dTag.dirty || dTag.touched)"
        >tag too long</mat-error
      >
    </mat-form-field>

    <!-- note -->
    <div>
      <mat-form-field>
        <mat-label>note</mat-label>
        <input matInput [formControl]="note" />
        <mat-error
          *ngIf="$any(note).errors?.maxLength && (note.dirty || note.touched)"
          >note too long</mat-error
        >
      </mat-form-field>
    </div>
  </div>
  <mat-error *ngIf="$any(form).errors?.unit && (form.dirty || form.touched)"
    >unit not set</mat-error
  >
</form>
